name: Build and deploy to riverus-contract-app
# Controls when the workflow will run
on:
# Triggers the workflow on push or pull request events but only for the "uat" branch
pull_request:
branches: [uat]
jobs:
build:
#The head_ref or source branch of the pull request in a workflow run.
if: github.head_ref == "staging"
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- uses: actions/setup-node@v2
with:
node-version: "19"
- run: rm -rf node_modules
- run: npm cache clean --force
- run: npm i --force
- run: CI='' npm run build:staging
# - run: yarn cache clean
# - run: yarn config set ignore-engines true
# - run: yarn
deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@uat
      - name: Download Artifact
        uses: actions/download-artifact@uat
        with:
          name: build
          path: ./build/
      - name: Deploy to S3
        env:
          AWS_ACCESS_KEY_ID: AKIA2BNAHQ7VXS53H4SS
          AWS_SECRET_ACCESS_KEY: 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
        run: |
          aws s3 cp \
          --recursive \
          --acl public-read \
          --region us-east-1 \
          ./build/* s3://nikhil-aws
